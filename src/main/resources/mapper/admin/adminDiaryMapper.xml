<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.go.ogamprj.mapper.AdminDiaryMapper">
    <!-- USER 일기 전체 가져오기 -->
    <select id="userDiarySelectAll" resultType="java.util.Map">
        SELECT
               d.DIARY_SEQ
             , d.DIARY_PRIVATE
             , e.EMOTION
             , e.EMOJI
             , m.MEMBER_EMAIL
             , m.MEMBER_NICK
          FROM diary d join emotions e
            ON e.EMOTION_SEQ = d.EMOTION_SEQ
          JOIN member m
            ON d.MEMBER_EMAIL = m.MEMBER_EMAIL
         WHERE d.DIARY_DEL = 'n'
         ORDER BY d.DIARY_SEQ desc
    </select>

    <!-- 키워드 검색 -->
    <select id="userDiarySelectKeyword" resultType="java.util.Map">
        SELECT
               d.DIARY_SEQ
             , d.DIARY_PRIVATE
             , e.EMOTION
             , e.EMOJI
             , m.MEMBER_EMAIL
             , m.MEMBER_NICK
          FROM diary d join emotions e
            ON e.EMOTION_SEQ = d.EMOTION_SEQ
          JOIN member m
            on d.MEMBER_EMAIL = m.MEMBER_EMAIL
         WHERE DIARY_DEL = 'n'
            <if test=" keyword != null and keyword != '' ">
                <choose>
                    <!-- 검색 유형이 있을 때 -->
                    <when test="type != null and type != ''">
                        <choose>
                            <when test="'DIARY_PRIVATE'.equals( type )">
                                AND d.DIARY_PRIVATE LIKE #{keyword}
                            </when>
                            <when test="'EMOTION'.equals( type )">
                                AND e.EMOTION LIKE #{keyword}
                            </when>
                            <when test="'MEMBER_EMAIL'.equals( type )">
                                AND m.MEMBER_EMAIL LIKE #{keyword}
                            </when>
                            <when test="'MEMBER_NICK'.equals( type )">
                                AND m.MEMBER_NICK LIKE #{keyword}
                            </when>
                        </choose>
                    </when>
                </choose>
            </if>

        ORDER BY d.DIARY_SEQ DESC
    </select>

    <!-- 일기 삭제 -->
    <update id="diaryDelete" parameterType="com.go.ogamprj.dto.Diary">
        UPDATE DIARY
           SET DIARY_DEL = 'y'
         WHERE DIARY_SEQ = #{DIARY_SEQ}
    </update>
</mapper>
