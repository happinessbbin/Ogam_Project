<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.go.ogamprj.mapper.NotifiMapper">

    <!--  친구 추가가 될때 알림에 insert  -->
    <insert id="notifiInsert" parameterType="com.go.ogamprj.dto.Notifi">
        insert into notifi
        values(noti_seq.nextval,#{member_email},null,#{noti_email},#{noti_type},current_date,null,'님에게 친구 신청이 왔습니다')
    </insert>

    <!-- 멤버 정보 가져오기 (사진, 닉네임)  -->
    <select id="notifiSelect" resultType="java.util.Map">
        select *
        from member m
            left join bgimage i
            on m.bgimg_seq = i.bgimg_seq
            join notifi n
            on n.member_email = m.member_email
        where n.noti_email =#{myEmail}
        and m.member_email in (
                (select member_email from member)
                minus
                (select member_email from block where block_email =#{myEmail})
                minus
                (select block_email from block where member_email =#{myEmail})
        )
    </select>
</mapper>